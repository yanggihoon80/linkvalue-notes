---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, updatedDate, heroImage, hideTitle } = Astro.props;

// ✅ 루트 운영 기준: base/withBase 제거
const BLOG_HOME = "/blog/"; // trailingSlash 항상 유지
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description ?? ""} />
    <style>
      main {
        width: calc(100% - 2em);
        max-width: 100%;
        margin: 0;
      }
      .hero-image {
        width: 720px;
        max-width: calc(100% - 2em);
        margin: 0 auto 1.25rem;
      }
      .hero-image img {
        display: block;
        width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: none !important;
      }
      .prose {
        width: 720px;
        max-width: calc(100% - 2em);
        margin: auto;
        padding: 1em;
        color: rgb(var(--gray-dark));
        font-size: 0.95rem;
        line-height: 1.7;
      }

      /* ✅ 뒤로가기 링크 */
      .topbar {
        width: 720px;
        max-width: calc(100% - 2em);
        margin: 0.75rem auto 0;
        padding: 0 1em;
      }
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        font-size: 0.9rem;
        color: rgb(var(--gray));
        text-decoration: none;
      }
      .back-link:hover {
        color: rgb(var(--gray-dark));
        text-decoration: underline;
      }

      .title {
        margin-bottom: 1em;
        padding: 1em 0;
        text-align: center;
        line-height: 1;
      }
      .title h1 {
        margin: 0 0 0.5em 0;
        font-size: 1.75rem;
        line-height: 1.25;
        font-weight: 800;
      }
      .prose h2 {
        margin-top: 2.2rem;
        margin-bottom: 0.75rem;
        font-size: 1.15rem;
        line-height: 1.35;
        font-weight: 700;
      }
      .prose h3 {
        margin-top: 1.8rem;
        margin-bottom: 0.6rem;
        font-size: 1.05rem;
        line-height: 1.4;
        font-weight: 600;
      }
      .prose p {
        margin: 0.85rem 0;
      }
      .prose blockquote {
        margin: 1.6rem 0;
        padding-left: 1rem;
        font-size: 0.95rem;
        line-height: 1.6;
        border-left: 3px solid rgb(var(--gray));
        color: rgb(var(--gray-dark));
      }
      .prose ul {
        margin: 0.8rem 0 0.8rem 1.1rem;
      }
      .prose li {
        margin: 0.4rem 0;
      }
      .date {
        margin-bottom: 0.5em;
        color: rgb(var(--gray));
        font-size: 0.9rem;
        opacity: 0.7;
      }
      .last-updated-on {
        font-style: italic;
      }
    </style>
  </head>

  <body>
    <!-- ✅ 헤더 제거, 뒤로가기만 -->
    <div class="topbar">
      <!-- ✅ 항상 /blog/ (슬래시 포함) -->
      <a class="back-link" href={BLOG_HOME}>← Back</a>
    </div>

    <main>
      <article>
        <!-- ✅ hero 영역은 이미지 전용 -->
        {heroImage && (
          <div class="hero-image">
            <img
              src={heroImage}
              alt={title}
              width="1020"
              height="510"
              loading="eager"
              decoding="async"
            />
          </div>
        )}

        <div class="prose">
          {!hideTitle && (
            <div class="title">
              <div class="date">
                <FormattedDate date={pubDate} />
                {updatedDate && (
                  <div class="last-updated-on">
                    Last updated on <FormattedDate date={updatedDate} />
                  </div>
                )}
              </div>
              <h1>{title}</h1>
              <hr />
            </div>
          )}

          <slot />
        </div>
      </article>
    </main>

    <!-- ✅ 글 상세에서는 SNS 아이콘 숨김 -->
    <Footer hideSocial={true} />
  </body>
</html>
